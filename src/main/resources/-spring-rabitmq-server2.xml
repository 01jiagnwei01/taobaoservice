<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns:p="http://www.springframework.org/schema/p"
       xsi:schemaLocation="http://www.springframework.org/schema/rabbit
           http://www.springframework.org/schema/rabbit/spring-rabbit.xsd
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd
           http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd">
           
     
	<!--   -->
 	<rabbit:template id="amqpServerTemplate" 
  			connection-factory="rabbitConnectionFactory"  
		    reply-timeout="2000" 
		    message-converter="jsonMessageConverter" 
		   exchange="app.stock.marketdata"
     > </rabbit:template> 
     
	<rabbit:queue id="stockRequestQueue" name="app.stock.request"/>
	 
	
	<!-- handlers -->
	<bean name="serverHandler" class="com.gxkj.taobaoservice.controllers.demo.stocks.handler.ServerHandler">
		<constructor-arg ref="executionVenueService"/>
		<constructor-arg ref="creditCheckService"/>
		<constructor-arg ref="tradingService"/>
	</bean>
	<!-- servers -->
	<bean id="executionVenueService"
		class="com.gxkj.taobaoservice.controllers.demo.stocks.service.stubs.ExecutionVenueServiceStub">
	</bean>

	<bean id="creditCheckService"
		class="com.gxkj.taobaoservice.controllers.demo.stocks.service.stubs.CreditCheckServiceStub">
	</bean>
	
	<bean id="tradingService"
		class="com.gxkj.taobaoservice.controllers.demo.stocks.service.stubs.TradingServiceStub">
	</bean>
	<!-- messages -->
	
	<listener-container concurrency="5" connection-factory="rabbitConnectionFactory" message-converter="jsonMessageConverter"
		xmlns="http://www.springframework.org/schema/rabbit">
		<listener ref="serverHandler" method="handleMessage"    queue-names="app.stock.request" />
	</listener-container>
	
	
	<bean id="marketDataGateway" class="com.gxkj.taobaoservice.controllers.demo.stocks.gateway.RabbitMarketDataGateway">
		<property name="rabbitTemplate" ref="amqpServerTemplate" />
	</bean>
	<!--jmx  -->
	 <context:mbean-export/>

    <bean id="registry" class="org.springframework.remoting.rmi.RmiRegistryFactoryBean"
          p:port="1099" />
    
    <!-- Expose JMX over RMI -->
    <bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean" depends-on="registry"
          p:objectName="connector:name=rmi"
          p:serviceUrl="service:jmx:rmi://localhost/jndi/rmi://localhost:1099/myconnector" /> 
 	
</beans>